# ä½ æ­£åœ¨è®¾è®¡ä¸€ä¸ªåŠ¨æ€æ•°ç»„ã€‚ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 0 å¼€å§‹çš„æ•´æ•°æ•°ç»„ nums ï¼Œå…¶ä¸­ nums[i] æ˜¯ i æ—¶åˆ»æ•°ç»„ä¸­çš„å…ƒç´ æ•°ç›®ã€‚é™¤æ­¤ä»¥å¤–ï¼Œä½ è¿˜æœ‰ä¸€ä¸ªæ•´æ•° k ï¼Œ
# è¡¨ç¤ºä½ å¯ä»¥ è°ƒæ•´ æ•°ç»„å¤§å°çš„ æœ€å¤š æ¬¡æ•°ï¼ˆæ¯æ¬¡éƒ½å¯ä»¥è°ƒæ•´æˆ ä»»æ„ å¤§å°ï¼‰ã€‚ 
# 
#  t æ—¶åˆ»æ•°ç»„çš„å¤§å° sizet å¿…é¡»å¤§äºç­‰äº nums[t] ï¼Œå› ä¸ºæ•°ç»„éœ€è¦æœ‰è¶³å¤Ÿçš„ç©ºé—´å®¹çº³æ‰€æœ‰å…ƒç´ ã€‚t æ—¶åˆ» æµªè´¹çš„ç©ºé—´ ä¸º sizet - nums[
# t] ï¼Œæ€» æµªè´¹ç©ºé—´ä¸ºæ»¡è¶³ 0 <= t < nums.length çš„æ¯ä¸€ä¸ªæ—¶åˆ» t æµªè´¹çš„ç©ºé—´ ä¹‹å’Œ ã€‚ 
# 
#  åœ¨è°ƒæ•´æ•°ç»„å¤§å°ä¸è¶…è¿‡ k æ¬¡çš„å‰æä¸‹ï¼Œè¯·ä½ è¿”å› æœ€å°æ€»æµªè´¹ç©ºé—´ ã€‚ 
# 
#  æ³¨æ„ï¼šæ•°ç»„æœ€å¼€å§‹æ—¶å¯ä»¥ä¸º ä»»æ„å¤§å° ï¼Œä¸” ä¸è®¡å…¥ è°ƒæ•´å¤§å°çš„æ“ä½œæ¬¡æ•°ã€‚ 
# 
#  
# 
#  ç¤ºä¾‹ 1ï¼š 
# 
#  è¾“å…¥ï¼šnums = [10,20], k = 0
# è¾“å‡ºï¼š10
# è§£é‡Šï¼šsize = [20,20].
# æˆ‘ä»¬å¯ä»¥è®©æ•°ç»„åˆå§‹å¤§å°ä¸º 20 ã€‚
# æ€»æµªè´¹ç©ºé—´ä¸º (20 - 10) + (20 - 20) = 10 ã€‚
#  
# 
#  ç¤ºä¾‹ 2ï¼š 
# 
#  è¾“å…¥ï¼šnums = [10,20,30], k = 1
# è¾“å‡ºï¼š10
# è§£é‡Šï¼šsize = [20,20,30].
# æˆ‘ä»¬å¯ä»¥è®©æ•°ç»„åˆå§‹å¤§å°ä¸º 20 ï¼Œç„¶åæ—¶åˆ» 2 è°ƒæ•´å¤§å°ä¸º 30 ã€‚
# æ€»æµªè´¹ç©ºé—´ä¸º (20 - 10) + (20 - 20) + (30 - 30) = 10 ã€‚
#  
# 
#  ç¤ºä¾‹ 3ï¼š 
# 
#  è¾“å…¥ï¼šnums = [10,20,15,30,20], k = 2
# è¾“å‡ºï¼š15
# è§£é‡Šï¼šsize = [10,20,20,30,30].
# æˆ‘ä»¬å¯ä»¥è®©æ•°ç»„åˆå§‹å¤§å°ä¸º 10 ï¼Œæ—¶åˆ» 1 è°ƒæ•´å¤§å°ä¸º 20 ï¼Œæ—¶åˆ» 3 è°ƒæ•´å¤§å°ä¸º 30 ã€‚
# æ€»æµªè´¹ç©ºé—´ä¸º (10 - 10) + (20 - 20) + (20 - 15) + (30 - 30) + (30 - 20) = 15 ã€‚
#  
# 
#  
# 
#  æç¤ºï¼š 
# 
#  
#  1 <= nums.length <= 200 
#  1 <= nums[i] <= 106 
#  0 <= k <= nums.length - 1 
#  
#  ğŸ‘ 9 ğŸ‘ 0
from typing import List
import functools
class Solution:
    def minSpaceWastedKResizing(self, nums: List[int], k: int) -> int:
        """
        é¢˜ç›®ç­‰ä»·äºï¼šæŠŠæ•°ç»„å®Œæ•´åˆ†æˆk+1æ®µè¿ç»­çš„å­æ•°ç»„ï¼Œæ¯ä¸€æ®µæƒå€¼æ˜¯[è¿™ä¸€æ®µæœ€å¤§å€¼ä¹˜ä»¥é•¿åº¦-è¿™ä¸€æ®µå…ƒç´ å’Œ]ï¼Œæœ€å°åŒ–æ€»æƒå€¼
        f[i][j]è¡¨ç¤ºå°†nums[0,..,i]åˆ†æˆjæ®µçš„æœ€å°æ€»æƒå€¼ã€‚æšä¸¾æœ€åä¸€æ®µæ¨çŠ¶æ€è½¬ç§»æ–¹ç¨‹
        f[i][j] = min(f[x-1][j-1] + g[x][i]) 0 <= x <= i
        g[x][i]è¡¨ç¤ºnums[x,...,i]è¿™ä¸€æ®µåŒºé—´çš„æƒå€¼
        æœ€ç»ˆç­”æ¡ˆä¸ºf[n-1][k+1]
        ç»†èŠ‚ï¼š
        å½“x=0æ—¶,f[-1][j-1]ä¸æ˜¯åˆæ³•çŠ¶æ€ï¼Œè€ƒè™‘f[-1][...]è¡¨ç¤ºçš„æ„ä¹‰ï¼š
        å¯¹äºä¸€æ®µç©ºæ•°ç»„ï¼Œå¸Œæœ›å°†ä»–åˆ†æˆè‹¥å¹²æ®µï¼Œç”±äºæ¯ä¸€æ®µè‡³å°‘è¦æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆç©ºæ•°ç»„åªèƒ½åˆ†æˆ0æ®µå³f[-1][0]=0
        è€Œä¸èƒ½åˆ†æˆä»»æ„æ­£æ•´æ•°æ®µï¼Œå³f[-1][^0]=inf(å› ä¸ºæ±‚æœ€å°æ€»æƒå€¼ï¼Œä¸åˆæ³•çš„æ ‡è®°ä¸ºæå¤§å€¼)
        ç„¶è€Œæœ¬é¢˜æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ€§è´¨å½“x1<x2æ—¶ï¼Œåˆ†æˆx1æ®µçš„æœ€å°æ€»æƒå€¼ä¸€å®šä¸ä¼šå°äºåˆ†æˆk2æ®µçš„æœ€å°æ€»æƒå€¼ï¼Œå› æ­¤å°†æ‰€æœ‰çš„f[-1][...]éƒ½ç½®ä¸º0ä¹Ÿä¸ä¼šå½±å“æœ€ç»ˆç­”æ¡ˆ
        """
        n = len(nums)
        g = [[0] * n for _ in range(n)]
        for i in range(n):
            best, total = 0, 0
            for j in range(i, n):
                best = max(best, nums[j])
                total += nums[j]
                g[i][j] = best * (j - i + 1) - total
        f = [[float('inf')] * (k + 2) for _ in range(n)]

        for i in range(n):
            for j in range(1, k + 2):
                for x in range(i + 1):
                    f[i][j] = min(f[i][j], (0 if x == 0 else f[x - 1][j - 1]) + g[x][i])
        return f[n-1][k+1]


# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def minSpaceWastedKResizing(self, nums: List[int], k: int) -> int:
        @functools.lru_cache(None)
        def dfs(start, left):
            if left == 1: return g[start][n-1]
            ans = float('inf')
            for i in range(start, n - left + 1):
                ans = min(ans, dfs(i + 1, left - 1) + g[start][i])
            return ans

        dfs.cache_clear()
        n = len(nums)
        g = [[0] * n for _ in range(n)]
        for i in range(n):
            best, total = 0, 0
            for j in range(i, n):
                best = max(best, nums[j])
                total += nums[j]
                g[i][j] = best * (j - i + 1) - total
        return dfs(0, k + 1)
# leetcode submit region end(Prohibit modification and deletion)
nums = [10,20,15,30,20]; k = 4
print(Solution().minSpaceWastedKResizing(nums, k))