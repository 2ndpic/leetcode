# ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ã€‚nums ä¸­ï¼Œå­æ•°ç»„çš„ èŒƒå›´ æ˜¯å­æ•°ç»„ä¸­æœ€å¤§å…ƒç´ å’Œæœ€å°å…ƒç´ çš„å·®å€¼ã€‚ 
# 
#  è¿”å› nums ä¸­ æ‰€æœ‰ å­æ•°ç»„èŒƒå›´çš„ å’Œ ã€‚ 
# 
#  å­æ•°ç»„æ˜¯æ•°ç»„ä¸­ä¸€ä¸ªè¿ç»­ éç©º çš„å…ƒç´ åºåˆ—ã€‚ 
# 
#  
# 
#  ç¤ºä¾‹ 1ï¼š 
# 
#  
# è¾“å…¥ï¼šnums = [1,2,3]
# è¾“å‡ºï¼š4
# è§£é‡Šï¼šnums çš„ 6 ä¸ªå­æ•°ç»„å¦‚ä¸‹æ‰€ç¤ºï¼š
# [1]ï¼ŒèŒƒå›´ = æœ€å¤§ - æœ€å° = 1 - 1 = 0 
# [2]ï¼ŒèŒƒå›´ = 2 - 2 = 0
# [3]ï¼ŒèŒƒå›´ = 3 - 3 = 0
# [1,2]ï¼ŒèŒƒå›´ = 2 - 1 = 1
# [2,3]ï¼ŒèŒƒå›´ = 3 - 2 = 1
# [1,2,3]ï¼ŒèŒƒå›´ = 3 - 1 = 2
# æ‰€æœ‰èŒƒå›´çš„å’Œæ˜¯ 0 + 0 + 0 + 1 + 1 + 2 = 4 
# 
#  ç¤ºä¾‹ 2ï¼š 
# 
#  
# è¾“å…¥ï¼šnums = [1,3,3]
# è¾“å‡ºï¼š4
# è§£é‡Šï¼šnums çš„ 6 ä¸ªå­æ•°ç»„å¦‚ä¸‹æ‰€ç¤ºï¼š
# [1]ï¼ŒèŒƒå›´ = æœ€å¤§ - æœ€å° = 1 - 1 = 0
# [3]ï¼ŒèŒƒå›´ = 3 - 3 = 0
# [3]ï¼ŒèŒƒå›´ = 3 - 3 = 0
# [1,3]ï¼ŒèŒƒå›´ = 3 - 1 = 2
# [3,3]ï¼ŒèŒƒå›´ = 3 - 3 = 0
# [1,3,3]ï¼ŒèŒƒå›´ = 3 - 1 = 2
# æ‰€æœ‰èŒƒå›´çš„å’Œæ˜¯ 0 + 0 + 0 + 2 + 0 + 2 = 4
#  
# 
#  ç¤ºä¾‹ 3ï¼š 
# 
#  
# è¾“å…¥ï¼šnums = [4,-2,-3,4,1]
# è¾“å‡ºï¼š59
# è§£é‡Šï¼šnums ä¸­æ‰€æœ‰å­æ•°ç»„èŒƒå›´çš„å’Œæ˜¯ 59
#  
# 
#  
# 
#  æç¤ºï¼š 
# 
#  
#  1 <= nums.length <= 1000 
#  -10â¹ <= nums[i] <= 10â¹ 
#  
# 
#  
# 
#  è¿›é˜¶ï¼šä½ å¯ä»¥è®¾è®¡ä¸€ç§æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ 
#  Related Topics æ ˆ æ•°ç»„ å•è°ƒæ ˆ ğŸ‘ 130 ğŸ‘ 0

from typing import List
# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def subArrayRanges(self, nums: List[int]) -> int:
        stack, ans = [], 0
        # åˆ©ç”¨å•è°ƒé€’å‡æ ˆï¼Œå¾—åˆ°popå‡ºæ¥çš„ä¸‹æ ‡iå·¦å³æœ€è¿‘çš„æ¯”nums[i]æ›´å¤§çš„ä½ç½®jk,nums[i]ä½œä¸ºåŒºåŸŸ(j, k)çš„æœ€å¤§å€¼
        for k, v in enumerate(nums + [float('inf')]):
            while stack and nums[stack[-1]] <= v:
                i, j = stack.pop(), stack[-1] if stack else -1
                ans += (i - j) * (k - i) * nums[i]
            stack.append(k)
        # åˆ©ç”¨å•è°ƒé€’å¢æ ˆï¼Œå¾—åˆ°popå‡ºæ¥çš„ä¸‹æ ‡iå·¦å³æœ€è¿‘çš„æ¯”nums[i]æ›´å°çš„ä½ç½®jk,nums[i]ä½œä¸ºåŒºåŸŸ(j,k)çš„æœ€å°å€¼
        stack = []
        for k, v in enumerate(nums + [float("-inf")]):
            while stack and nums[stack[-1]] > v:
                i, j = stack.pop(), stack[-1] if stack else -1
                ans -= (i - j) * (k - i) * nums[i]
            stack.append(k)
        return ans
# leetcode submit region end(Prohibit modification and deletion)
nums = [30,20,10,20]
print(Solution().subArrayRanges(nums))